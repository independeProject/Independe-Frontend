<template>
  <v-app>
    <v-main>
      <v-container>
        <v-row>
          <v-col cols="auto">
            <div v-if="areaCheck === 0">
              <h1 class="font-weight-bold">
                자유게시판
              </h1>
            </div>
            <div v-else>
              <h1 class="font-weight-bold">
                {{ regions[regionCheck] }} 이야기
              </h1>
            </div>
          </v-col>
          <v-row class="mx-5 mt-2">
            <div v-if="regionCheck === 0">
              <router-link
                :to="{ params: { regionType: regionsAPI[0], regionPostType: 'FREE' } }"
                style="text-decoration: none; color:#5E913B;"
              >
                <v-btn
                  class="mt-3 text-h6"
                  width="75"
                  variant="text"
                  @click="region_all"
                >
                  <p
                    style="font-size:20px"
                    class="font-weight-bold"
                  >
                    {{ regions[0] }}
                  </p>
                </v-btn>
              </router-link>
            </div>
            <div v-else>
              <router-link
                :to="{ params: { regionType: regionsAPI[0], regionPostType: 'FREE' } }"
                style="text-decoration: none; color:grey;"
              >
                <v-btn
                  class="mt-3"
                  width="75"
                  variant="plain"
                  @click="region_all"
                >
                  <p
                    style="font-size:20px"
                    class="font-weight-bold"
                  >
                    {{ regions[0] }}
                  </p>
                </v-btn>
              </router-link>
            </div>
            <div v-if="regionCheck === 1">
              <router-link
                :to="{ params: { regionType: regionsAPI[1], regionPostType: regionCategoryAPI[1] } }"
                style="text-decoration: none; color:#5E913B;"
              >
                <v-btn
                  class="mt-3 text-h6"
                  width="75"
                  variant="text"
                  @click="region_seoul"
                >
                  <p
                    style="font-size:20px"
                    class="font-weight-bold"
                  >
                    {{ regions[1] }}
                  </p>
                </v-btn>
              </router-link>
            </div>
            <div v-else>
              <router-link
                :to="{ params: { regionType: regionsAPI[1], regionPostType: regionCategoryAPI[1] } }"
                style="text-decoration: none; color:grey;"
              >
                <v-btn
                  class="mt-3"
                  width="75"
                  variant="plain"
                  @click="region_seoul"
                >
                  <p
                    style="font-size:20px"
                    class="font-weight-bold"
                  >
                    {{ regions[1] }}
                  </p>
                </v-btn>
              </router-link>
            </div>
            <div v-if="regionCheck === 2">
              <router-link
                :to="{ params: { regionType: regionsAPI[2], regionPostType: regionCategoryAPI[1] } }"
                style="text-decoration: none; color:#5E913B;"
              >
                <v-btn
                  class="mt-3 text-h6"
                  width="75"
                  variant="text"
                  @click="region_busan"
                >
                  <p
                    style="font-size:20px"
                    class="font-weight-bold"
                  >
                    {{ regions[2] }}
                  </p>
                </v-btn>
              </router-link>
            </div>
            <div v-else>
              <router-link
                :to="{ params: { regionType: regionsAPI[2], regionPostType: regionCategoryAPI[1] } }"
                style="text-decoration: none; color:grey;"
              >
                <v-btn
                  class="mt-3"
                  width="75"
                  variant="plain"
                  @click="region_busan"
                >
                  <p
                    style="font-size:20px"
                    class="font-weight-bold"
                  >
                    {{ regions[2] }}
                  </p>
                </v-btn>
              </router-link>
            </div>
            <div v-if="regionCheck === 3">
              <router-link
                :to="{ params: { regionType: regionsAPI[3], regionPostType: regionCategoryAPI[1] } }"
                style="text-decoration: none; color:#5E913B;"
              >
                <v-btn
                  class="mt-3 text-h6"
                  width="75"
                  variant="text"
                  @click="region_ulsan"
                >
                  <p
                    style="font-size:20px"
                    class="font-weight-bold"
                  >
                    {{ regions[3] }}
                  </p>
                </v-btn>
              </router-link>
            </div>
            <div v-else>
              <router-link
                :to="{ params: { regionType: regionsAPI[3], regionPostType: regionCategoryAPI[1] } }"
                style="text-decoration: none; color:grey;"
              >
                <v-btn
                  class="mt-3"
                  width="75"
                  variant="plain"
                  @click="region_ulsan"
                >
                  <p
                    style="font-size:20px"
                    class="font-weight-bold"
                  >
                    {{ regions[3] }}
                  </p>
                </v-btn>
              </router-link>
            </div>
            <div v-if="regionCheck === 4">
              <router-link
                :to="{ params: { regionType: regionsAPI[4], regionPostType: regionCategoryAPI[1] } }"
                style="text-decoration: none; color:#5E913B;"
              >
                <v-btn
                  class="mt-3 text-h6"
                  width="75"
                  variant="text"
                  @click="region_kyeongnam"
                >
                  <p
                    style="font-size:20px"
                    class="font-weight-bold"
                  >
                    {{ regions[4] }}
                  </p>
                </v-btn>
              </router-link>
            </div>
            <div v-else>
              <router-link
                :to="{ params: { regionType: regionsAPI[4], regionPostType: regionCategoryAPI[1] } }"
                style="text-decoration: none; color:grey;"
              >
                <v-btn
                  class="mt-3"
                  width="75"
                  variant="plain"
                  @click="region_kyeongnam"
                >
                  <p
                    style="font-size:20px"
                    class="font-weight-bold"
                  >
                    {{ regions[4] }}
                  </p>
                </v-btn>
              </router-link>
            </div>
          </v-row>
        </v-row>

        <div v-show="areaCheck === 1">
          <v-divider
            :thickness="1"
            class="border-opacity-25 my-3"
            length="1160"
          />
        </div>

        <div v-if="areaCheck === 1">
          <v-row>
            <v-col>
              <v-slide-group show-arrows>
                <v-slide-group-item>
                  <div v-if="regionCategoryCheck === 1">
                    <router-link
                      :to="{ params: { regionType: regionsAPI[regionCheck], regionPostType: regionCategoryAPI[1] } }"
                      style="text-decoration: none;"
                    >
                      <v-btn
                        class="ma-2 font-weight-bold button"
                        rounded
                        :width="100"
                        color="#5E913B"
                        style="color:white"
                        @click="regionCategory_talk"
                      >
                        {{ regionCategory[1] }}
                      </v-btn>
                    </router-link>
                  </div>
                  <div v-else>
                    <router-link
                      :to="{ params: { regionType: regionsAPI[regionCheck], regionPostType: regionCategoryAPI[1] } }"
                      style="text-decoration: none;"
                    >
                      <v-btn
                        class="ma-2"
                        rounded
                        :width="100"
                        style="color:black"
                        @click="regionCategory_talk"
                      >
                        {{ regionCategory[1] }}
                      </v-btn>
                    </router-link>
                  </div>
                  <div v-if="regionCategoryCheck === 2">
                    <router-link
                      :to="{ params: { regionType: regionsAPI[regionCheck], regionPostType: regionCategoryAPI[2] } }"
                      style="text-decoration: none;"
                    >
                      <v-btn
                        class="ma-2 font-weight-bold button"
                        rounded
                        :width="100"
                        color="#5E913B"
                        style="color:white"
                        @click="regionCategory_restaurant"
                      >
                        {{ regionCategory[2] }}
                      </v-btn>
                    </router-link>
                  </div>
                  <div v-else>
                    <router-link
                      :to="{ params: { regionType: regionsAPI[regionCheck], regionPostType: regionCategoryAPI[2] } }"
                      style="text-decoration: none;"
                    >
                      <v-btn
                        class="ma-2"
                        rounded
                        :width="100"
                        style="color:black"
                        @click="regionCategory_restaurant"
                      >
                        {{ regionCategory[2] }}
                      </v-btn>
                    </router-link>
                  </div>

                  <div v-if="regionCategoryCheck === 3">
                    <router-link
                      :to="{ params: { regionType: regionsAPI[regionCheck], regionPostType: regionCategoryAPI[3] } }"
                      style="text-decoration: none;"
                    >
                      <v-btn
                        class="ma-2 font-weight-bold button"
                        rounded
                        :width="100"
                        color="#5E913B"
                        style="color:white"
                        @click="regionCategory_play"
                      >
                        {{ regionCategory[3] }}
                      </v-btn>
                    </router-link>
                  </div>
                  <div v-else>
                    <router-link
                      :to="{ params: { regionType: regionsAPI[regionCheck], regionPostType: regionCategoryAPI[3] } }"
                      style="text-decoration: none;"
                    >
                      <v-btn
                        class="ma-2"
                        rounded
                        :width="100"
                        style="color:black"
                        @click="regionCategory_play"
                      >
                        {{ regionCategory[3] }}
                      </v-btn>
                    </router-link>
                  </div>

                  <div v-if="regionCategoryCheck === 4">
                    <router-link
                      :to="{ params: { regionType: regionsAPI[regionCheck], regionPostType: regionCategoryAPI[4] } }"
                      style="text-decoration: none;"
                    >
                      <v-btn
                        class="ma-2 font-weight-bold button"
                        rounded
                        :width="100"
                        color="#5E913B"
                        style="color:white"
                        @click="regionCategory_meet"
                      >
                        {{ regionCategory[4] }}
                      </v-btn>
                    </router-link>
                  </div>
                  <div v-else>
                    <router-link
                      :to="{ params: { regionType: regionsAPI[regionCheck], regionPostType: regionCategoryAPI[4] } }"
                      style="text-decoration: none;"
                    >
                      <v-btn
                        class="ma-2"
                        rounded
                        :width="100"
                        style="color:black"
                        @click="regionCategory_meet"
                      >
                        {{ regionCategory[4] }}
                      </v-btn>
                    </router-link>
                  </div>

                  <div v-if="regionCategoryCheck === 5">
                    <router-link
                      :to="{ params: { regionType: regionsAPI[regionCheck], regionPostType: regionCategoryAPI[5] } }"
                      style="text-decoration: none;"
                    >
                      <v-btn
                        class="ma-2 font-weight-bold button"
                        rounded
                        :width="100"
                        color="#5E913B"
                        style="color:white"
                        @click="regionCategory_market"
                      >
                        {{ regionCategory[5] }}
                      </v-btn>
                    </router-link>
                  </div>
                  <div v-else>
                    <router-link
                      :to="{ params: { regionType: regionsAPI[regionCheck], regionPostType: regionCategoryAPI[5] } }"
                      style="text-decoration: none;"
                    >
                      <v-btn
                        class="ma-2"
                        rounded
                        :width="100"
                        style="color:black"
                        @click="regionCategory_market"
                      >
                        {{ regionCategory[5] }}
                      </v-btn>
                    </router-link>
                  </div>
                </v-slide-group-item>
              </v-slide-group>
            </v-col>
          </v-row>
        </div>
        <v-divider
          :thickness="1"
          class="border-opacity-25 my-3"
          length="1160"
        />
        <v-row class="mx-1 mt-3">
          <v-sheet
            :height="30"
            :width="1150"
            class="mb-2 font-weight-bold"
            align="center"
            justify="center"
          >
            <v-row>
              <v-col cols="1">
                시각
              </v-col>
              <v-col cols="6">
                제목
              </v-col>
              <v-col cols="2">
                작성자
              </v-col>
              <v-col cols="3">
                <v-row>
                  <v-col cols="4">
                    댓글수
                  </v-col>
                  <v-col cols="4">
                    추천수
                  </v-col>
                  <v-col cols="4">
                    조회수
                  </v-col>
                </v-row>
              </v-col>
            </v-row>
          </v-sheet>
          <v-divider
            :thickness="1"
            class="border-opacity-25 mb-3"
            length="1160"
          />
          <v-sheet :width="1150">
            <v-list
              v-for="Board in BoardList"
              :key="Board"
              style="overflow:hidden; font-size:14px"
            >
              <v-row>
                <v-col cols="1">
                  <div
                    v-if="$filter.formatDate(Board.createdDate) === today"
                    align="center"
                    justify="center"
                  >
                    {{ $filter.formatTime(Board.createdDate) }}
                  </div>
                  <div
                    v-else
                    align="center"
                    justify="center"
                  >
                    {{ $filter.formatDate(Board.createdDate) }}
                  </div>
                </v-col>
                <v-col cols="6">
                  <div v-if="Board.title.length < 37">
                    <v-img
                      v-if="Board.picture === true"
                      style="float:left"
                      :width="15"
                      src="../img/imagePlaceHolder.png"
                      class="mr-1 pt-1"
                    />
                    <router-link
                      :to="{ name: 'PostView', params: { postId: Board.postId } }"
                      style="text-decoration: none; color:black;"
                    >
                      {{ Board.title }}
                    </router-link>
                  </div>
                  <div v-else>
                    <v-img
                      v-if="Board.picture === true"
                      style="float:left"
                      :width="15"
                      src="../img/imagePlaceHolder.png"
                      class="mr-1 pt-1"
                    />
                    <router-link
                      :to="{ name: 'PostView', params: { postId: Board.postId } }"
                      style="text-decoration: none; color:black;"
                    >
                      <p>{{ Board.title.substr(0, 37) }}...</p>
                    </router-link>
                  </div>
                </v-col>
                <v-col cols="2">
                  {{ Board.nickName }}
                </v-col>
                <v-col cols="3">
                  <v-row>
                    <v-col cols="4">
                      <div>
                        <v-img
                          style="float:left;"
                          :width="15"
                          src="../img/commentIcon.png"
                          class="my-1 mx-1"
                        />
                        <div v-if="Board.commentCount < 100000">
                          <p class="text-grey-darken-1 mx-1">
                            {{ Board.commentCount }}
                          </p>
                        </div>
                        <div v-else>
                          <p class="text-grey-darken-1">
                            99999+
                          </p>
                        </div>
                      </div>
                    </v-col>
                    <v-col cols="4">
                      <div>
                        <v-img
                          style="float:left"
                          :width="15"
                          src="../img/recommendIcon.png"
                          class="my-1 mx-1"
                        />
                        <div v-if="Board.recommendCount < 100000">
                          <p class="text-grey-darken-1 mx-1">
                            {{ Board.recommendCount }}
                          </p>
                        </div>
                        <div v-else>
                          <p class="text-grey-darken-1">
                            99999+
                          </p>
                        </div>
                      </div>
                    </v-col>
                    <v-col cols="4">
                      <div>
                        <v-img
                          style="float:left"
                          :width="15"
                          src="../img/viewIcon.png"
                          class="my-1 mx-1"
                        />
                        <div v-if="Board.views < 100000">
                          <p class="text-grey-darken-1 mx-1">
                            {{ Board.views }}
                          </p>
                        </div>
                        <div v-else>
                          <p class="text-grey-darken-1">
                            99999+
                          </p>
                        </div>
                      </div>
                    </v-col>
                  </v-row>
                </v-col>
              </v-row>
              <v-divider
                :thickness="1"
                class="border-opacity-25 mt-3"
                length="1160"
              />
            </v-list>

            <!--검색-->
            <v-row
              class="mt-3"
              align="center"
            >
              <v-col cols="5">
                <v-row align="center">
                  <v-menu>
                    <template #activator="{ props }">
                      <v-btn
                        v-bind="props"
                        style="width:130px; height:40px; border-color:#A9A9A9"
                        variant="outlined"
                      >
                        <p>{{ search[searchCondition] }} ▼</p>
                      </v-btn>
                    </template>
                    <v-list>
                      <v-list-item style="text-align: center;">
                        <v-list-item-title
                          style="cursor: pointer;"
                          class="my-2"
                          @click="searchCondition = 0"
                        >
                          제목 +
                          내용
                        </v-list-item-title>
                        <v-divider
                          :thickness="1"
                          class="border-opacity-25 mb-2"
                        />
                        <v-list-item-title
                          style="cursor: pointer;"
                          class="my-2"
                          @click="searchCondition = 1"
                        >
                          제목
                        </v-list-item-title>
                        <v-divider
                          :thickness="1"
                          class="border-opacity-25 mb-2"
                        />
                        <v-list-item-title
                          style="cursor: pointer;"
                          class="my-2"
                          @click="searchCondition = 2"
                        >
                          내용
                        </v-list-item-title>
                        <v-divider
                          :thickness="1"
                          class="border-opacity-25 mb-2"
                        />
                        <v-list-item-title
                          style="cursor: pointer;"
                          class="my-2"
                          @click="searchCondition = 3"
                        >
                          작성자
                        </v-list-item-title>
                      </v-list-item>
                    </v-list>
                  </v-menu>
                  <v-card-text>
                    <v-text-field
                      v-model="searchKeyword"
                      :loading="error"
                      density="compact"
                      variant="outlined"
                      single-line
                      hide-details
                    />
                  </v-card-text>
                  <router-link
                    :to="{
                      path: $route.path,
                      query: {
                        ...$route.query,
                        condition: searchAPI[searchCondition],
                        keyword: searchKeyword
                      }
                    }"
                    style="text-decoration: none; color:#5E913B;"
                  >
                    <v-img
                      width="23"
                      height="23"
                      src="../img/boardSearch.png"
                      :style="{ cursor: 'pointer' }"
                      @click="boardSearch"
                    />
                  </router-link>
                </v-row>
              </v-col>
              <v-col>
                <v-row justify="end">
                  <v-btn
                    v-if="getToken"
                    variant="flat"
                    color="#5E913B"
                    class="font-weight-bold"
                    to="/PostWrite"
                  >
                    <div class="text-white">
                      글쓰기
                    </div>
                  </v-btn>
                </v-row>
              </v-col>
            </v-row>

            <v-row justify="center">
              <div v-if="totalPage <= 10">
                <v-row
                  class="my-3"
                  justify="center"
                >
                  <div
                    v-for="curPage in totalPage"
                    :key="curPage"
                    @click="currentPage = curPage - 1, page()"
                  >
                    <router-link
                      :to="{ params: { regionType: regionsAPI[regionCheck], regionPostType: regionCategoryAPI[regionCategoryCheck] }, query: { page: curPage } }"
                      style="text-decoration: none;"
                    >
                      <div v-if="currentPage === curPage - 1">
                        <v-btn
                          variant="text"
                          size="x-small"
                          class="font-weight-bold"
                          style="font-size: 16px; color:#5E913B;"
                        >
                          {{ curPage }}
                        </v-btn>
                      </div>
                      <div v-else>
                        <v-btn
                          variant="text"
                          size="x-small"
                          style="font-size: 14px; color:#A9A9A9"
                        >
                          {{ curPage
                          }}
                        </v-btn>
                      </div>
                    </router-link>
                  </div>
                </v-row>
              </div>
              <div v-else>
                <v-row class="my-3">
                  <router-link
                    :to="{ params: { regionType: regionsAPI[regionCheck], regionPostType: regionCategoryAPI[regionCategoryCheck] }, query: { page: currentPage } }"
                    style="text-decoration: none;"
                    @click="page()"
                  >
                    <v-btn
                      :disabled="currentPage < 1"
                      variant="text"
                      size="x-small"
                      :style="{ color: currentPage <= 1 ? '#5E913B' : '' }"
                      @click="currentPage = 0"
                    >
                      <div style="color:#A9A9A9; font-size:16px">
                        &lt;&lt;
                      </div>
                    </v-btn>
                  </router-link>
                  <router-link
                    :to="{ params: { regionType: regionsAPI[regionCheck], regionPostType: regionCategoryAPI[regionCategoryCheck] }, query: { page: currentPage } }"
                    style="text-decoration: none;"
                    @click="page()"
                  >
                    <v-btn
                      :disabled="currentPage < 1"
                      variant="text"
                      size="x-small"
                      :style="{ color: currentPage <= 1 ? '#5E913B' : '' }"
                      @click="currentPage = Math.max(currentPage - 10, 0)"
                    >
                      <div style="color:#A9A9A9; font-size:16px">
                        &lt;
                      </div>
                    </v-btn>
                  </router-link>
                  <div
                    v-for="pageNumber in displayPageNumbers"
                    :key="pageNumber"
                    :class="{ active: pageNumber === currentPage, 'last-page': pageNumber === displayPageNumbers[displayPageNumbers.length - 1] }"
                    @click="currentPage = pageNumber - 1, page()"
                  >
                    <router-link
                      :to="{ params: { regionType: regionsAPI[regionCheck], regionPostType: regionCategoryAPI[regionCategoryCheck] }, query: { page: pageNumber } }"
                      style="text-decoration: none;"
                    >
                      <div v-if="currentPage === pageNumber - 1">
                        <v-btn
                          variant="text"
                          size="x-small"
                          class="font-weight-bold"
                          style="font-size: 16px; color:#5E913B"
                          @click="currentPage = pageNumber"
                        >
                          {{ pageNumber }}
                        </v-btn>
                      </div>
                      <div v-else-if="currentPage >= totalPage">
                        <v-btn
                          variant="text"
                          size="x-small"
                          :style="{ fontSize: pageNumber === displayPageNumbers[displayPageNumbers.length - 1] ? '16px' : '14px', fontWeight: pageNumber === displayPageNumbers[displayPageNumbers.length - 1] && 'bold', color: pageNumber === displayPageNumbers[displayPageNumbers.length - 1] ? '#5E913B' : '#A9A9A9' }"
                          @click="currentPage = pageNumber"
                        >
                          {{
                            pageNumber }}
                        </v-btn>
                      </div>
                      <div v-else>
                        <v-btn
                          variant="text"
                          size="x-small"
                          style="font-size: 14px; color:#A9A9A9"
                          @click="currentPage = pageNumber"
                        >
                          {{ pageNumber }}
                        </v-btn>
                      </div>
                    </router-link>
                  </div>
                  <router-link
                    :to="{ params: { regionType: regionsAPI[regionCheck], regionPostType: regionCategoryAPI[regionCategoryCheck] }, query: { page: currentPage } }"
                    style="text-decoration: none;"
                    :style="{ color: currentPage >= totalPage ? '#5E913B' : '' }"
                    @click="page()"
                  >
                    <v-btn
                      :disabled="currentPage >= totalPage - 1"
                      variant="text"
                      size="x-small"
                      style="font-size: 14px;"
                      @click="currentPage = Math.min(currentPage + 10, totalPage)"
                    >
                      <div style="color:#A9A9A9; font-size:16px">
                        &gt;
                      </div>
                    </v-btn>
                  </router-link>
                  <router-link
                    :to="{ params: { regionType: regionsAPI[regionCheck], regionPostType: regionCategoryAPI[regionCategoryCheck] }, query: { page: currentPage } }"
                    style="text-decoration: none;"
                    :style="{ color: currentPage >= totalPage ? '#5E913B' : '' }"
                    @click="page()"
                  >
                    <v-btn
                      :disabled="currentPage >= totalPage - 1"
                      variant="text"
                      size="x-small"
                      style="font-size: 14px;"
                      @click="currentPage = totalPage"
                    >
                      <div style="color:#A9A9A9; font-size:16px">
                        &gt;&gt;
                      </div>
                    </v-btn>
                  </router-link>
                </v-row>
              </div>
            </v-row>
          </v-sheet>
        </v-row>
      </v-container>
    </v-main>
  </v-app>
</template>
  
<script>
import { mapGetters } from 'vuex';
import { getAddr } from '../utils';

export default {
  name: 'BoardView',
  data() {
    return {
      active_tab: 1,

      now: "",
      month: "",
      day: "",
      today: "",

      BoardList: [],

      currentPage: 0,
      totalPage: [],

      areaCheck: 0,
      regionCheck: 0,
      regionCategoryCheck: 1,
      regions: ['자유', '서울', '부산', '울산', '경남'],
      regionCategory: ['자유', '잡담', '식당', '오락', '만남', '장터'],

      regionsAPI: ["ALL", 'SEOUL', 'PUSAN', 'ULSAN', 'KYEONGNAM'],
      regionCategoryAPI: ["FREE", 'TALK', 'RESTAURANT', 'PLAY', 'MEET', 'MARKET'],

      link: ['메인', '게시판', '자취생활'],
      search: ['제목 + 내용', '제목', '내용', '작성자'],
      searchAPI: ['all', 'title', 'content', 'nickname'],
      searchCondition: 0,
      searchKeyword: '',

      showLocationAuthentication: false,
      userNickName: '',
      boolAuthentication: false,

      searchText: '', // 검색어를 저장하는 데이터 속성
      error: false, // 로딩 상태를 나타내는 데이터 속성
    }
  },
  computed: {
    displayPageNumbers() {
      const currentPage = this.currentPage;
      const totalPage = this.totalPage;
      const pageNumbers = [];
      let startPage = 1;
      let endPage = 10;
      let diff = totalPage - currentPage;

      if (totalPage <= 10) {
        for (let i = 1; i <= totalPage; i++) {
          pageNumbers.push(i);
        }
      } else if (diff < 5) {
        startPage = totalPage - 9;
        endPage = totalPage;
      } else if (currentPage > 5) {
        startPage = currentPage - 4;
        endPage = currentPage + 5;
      }
      for (let i = startPage; i <= endPage; i++) {
        pageNumbers.push(i);
      }
      return pageNumbers;
    },
    ...mapGetters(['getToken']),
  },
  created() {
    window.addEventListener('popstate', () => {
      const pathname = window.location.pathname;
      if (pathname.startsWith('/board/')) {
        this.isBackButtonClicked = true
        const url = window.location.href;
        const segments = url.split('/');
        const value = segments[segments.length - 2];
        const arr = ["ALL", 'SEOUL', 'PUSAN', 'ULSAN', 'KYEONGNAM']
        const index = arr.indexOf(value)

        const url2 = window.location.href;
        const segments2 = url2.split('/');
        const value2 = segments2[segments.length - 1];
        const arr2 = ["FREE", 'TALK', 'RESTAURANT', 'PLAY', 'MEET', 'MARKET']
        const index2 = arr2.indexOf(value2)

        this.regionCategoryCheck = index2
        this.regionCheck = index
        this.$store.state.boardCheck = index

        if (this.$store.state.boardCheck === 0) {
          this.region_all()
        } else if (this.$store.state.boardCheck === 1) {
          this.region_seoul()
        } else if (this.$store.state.boardCheck === 2) {
          this.region_busan()
        } else if (this.$store.state.boardCheck === 3) {
          this.region_ulsan()
        } else if (this.$store.state.boardCheck === 4) {
          this.region_kyeongnam()
        }

        if (this.areaCheck === 1) {
          if (index2 === 1) {
            this.regionCategory_talk()
          } else if (index2 === 2) {
            this.regionCategory_restaurant()
          } else if (index2 === 3) {
            this.regionCategory_play()
          } else if (index2 === 4) {
            this.regionCategory_meet()
          } else if (index2 === 5) {
            this.regionCategory_market()
          } else if (index2 === 0) {
            this.region_all()
          }
        }
      } else {
        window.location.href = pathname;
      }
    })
  },
  mounted() {
    this.$store.state.independentCheck = 5;

    if (this.$store.state.boardCheck === 0) {
      this.region_all();
    } else if (this.$store.state.boardCheck === 1) {
      this.region_seoul();
    } else if (this.$store.state.boardCheck === 2) {
      this.region_busan();
    } else if (this.$store.state.boardCheck === 3) {
      this.region_ulsan();
    } else if (this.$store.state.boardCheck === 4) {
      this.region_kyeongnam();
    }

    if (this.$store.state.categoryCheck === 1) {
      this.regionCategory_talk();
    } else if (this.$store.state.categoryCheck === 2) {
      this.regionCategory_restaurant();
    } else if (this.$store.state.categoryCheck === 3) {
      this.regionCategory_play();
    } else if (this.$store.state.categoryCheck === 4) {
      this.regionCategory_meet();
    } else if (this.$store.state.categoryCheck === 5) {
      this.regionCategory_market();
    }

    this.date();

    if (this.$store.state.locationAuthentication === true) {
      this.getAddr();
      this.boolAuthentication = true;
    } else {
      this.boolAuthentication = false;
    }

    if (this.getToken) {
      this.loginToken();
    }
  },
  methods: {
    updateBoardCheck(newValue) {
      this.$store.dispatch('updateBoardCheck', newValue);
    },
    updateCategoryCheck(newValue) {
      this.$store.dispatch('updateCategoryCheck', newValue);
    },
    boardSearch() {
      // 검색 요청을 보낼 URL 생성
      const url = `/api/posts/region/${this.regionsAPI[this.regionCheck]}/${this.regionCategoryAPI[this.regionCategoryCheck]}`;

      // 검색 요청 보내기
      this.$axios.get(url, {
        params: {
          condition: this.searchAPI[this.searchCondition],
          keyword: this.searchKeyword,
          page: this.currentPage
        }
      }, {
        headers: {
          Authorization: this.$store.state.token, // 헤더에 토큰 추가
        },
      })
        .then(res => {
          // 검색 결과 처리
          this.BoardList = res.data.data;
          this.totalPage = res.data.count;

          // 페이지 처리 코드...
          if (this.totalPage < 10) {
            this.totalPage = 1
          } else if (this.totalPage % 10 === 0) {
            this.totalPage = parseInt(this.totalPage / 10)
          } else {
            this.totalPage = parseInt(this.totalPage / 10) + 1
          }

          console.log(res.data);
        })
        .catch(function (error) {
          console.log(error);
        });
    },
    region_all() {
      this.areaCheck = 0
      this.regionCheck = 0
      this.regionCategoryCheck = 0
      this.$store.state.boardCheck = 0
      this.updateBoardCheck(0)
      this.updateCategoryCheck(0)
      this.currentPage = 0;
      const url = `/api/posts/region/${this.regionsAPI[0]}/${this.regionCategoryAPI[this.regionCategoryCheck]}`;

      //this.$axios.get('https://ba9fe6f7-8331-4cd6-bd3e-1323d53d8567.mock.pstmn.io/independe', { params: { page: this.currentPage } })
      this.$axios.get(url, { params: { page: this.currentPage } }, {
        headers: {
          Authorization: this.$store.state.token, // 헤더에 토큰 추가
        },
      })
        .then(res => {
          this.BoardList = res.data.data
          this.totalPage = res.data.count

          if (this.totalPage < 10) {
            this.totalPage = 1
          } else if (this.totalPage % 10 === 0) {
            this.totalPage = parseInt(this.totalPage / 10)
          } else {
            this.totalPage = parseInt(this.totalPage / 10) + 1
          }

          this.searchKeyword = ''
          this.searchCondition = 0
          console.log(res.data)
        })
        .catch(function (error) {
          console.log(error);
        });
    },
    region_seoul() {
      this.areaCheck = 1
      this.regionCheck = 1
      this.regionCategoryCheck = 1
      this.$store.state.boardCheck = 1
      this.updateBoardCheck(1)
      this.currentPage = 0;
      const url = `/api/posts/region/${this.regionsAPI[1]}/${this.regionCategoryAPI[this.regionCategoryCheck]}`;

      this.$axios.get(url, { params: { page: this.currentPage } }, {
        headers: {
          Authorization: this.$store.state.token, // 헤더에 토큰 추가
        },
      })
        .then(res => {
          this.BoardList = res.data.data
          this.totalPage = res.data.count

          if (this.totalPage < 10) {
            this.totalPage = 1
          } else if (this.totalPage % 10 === 0) {
            this.totalPage = parseInt(this.totalPage / 10)
          } else {
            this.totalPage = parseInt(this.totalPage / 10) + 1
          }

          this.searchKeyword = ''
          this.searchCondition = 0
          console.log(res.data)
        })
        .catch(function (error) {
          console.log(error);
        });
    },
    region_busan() {
      this.areaCheck = 1
      this.regionCheck = 2
      this.regionCategoryCheck = 1
      this.$store.state.boardCheck = 2
      this.updateBoardCheck(2)
      this.currentPage = 0;
      const url = `/api/posts/region/${this.regionsAPI[2]}/${this.regionCategoryAPI[this.regionCategoryCheck]}`;

      this.$axios.get(url, { params: { page: this.currentPage } }, {
        headers: {
          Authorization: this.$store.state.token, // 헤더에 토큰 추가
        },
      })
        .then(res => {
          this.BoardList = res.data.data
          this.totalPage = res.data.count

          if (this.totalPage < 10) {
            this.totalPage = 1
          } else if (this.totalPage % 10 === 0) {
            this.totalPage = parseInt(this.totalPage / 10)
          } else {
            this.totalPage = parseInt(this.totalPage / 10) + 1
          }

          this.searchKeyword = ''
          this.searchCondition = 0
          console.log(res.data)
        })
        .catch(function (error) {
          console.log(error);
        });
    },
    region_ulsan() {
      this.areaCheck = 1
      this.regionCheck = 3
      this.regionCategoryCheck = 1
      this.$store.state.boardCheck = 3
      this.updateBoardCheck(3)
      this.currentPage = 0;
      const url = `/api/posts/region/${this.regionsAPI[3]}/${this.regionCategoryAPI[this.regionCategoryCheck]}`;

      this.$axios.get(url, { params: { page: this.currentPage } }, {
        headers: {
          Authorization: this.$store.state.token, // 헤더에 토큰 추가
        },
      })
        .then(res => {
          this.BoardList = res.data.data
          this.totalPage = res.data.count

          if (this.totalPage < 10) {
            this.totalPage = 1
          } else if (this.totalPage % 10 === 0) {
            this.totalPage = parseInt(this.totalPage / 10)
          } else {
            this.totalPage = parseInt(this.totalPage / 10) + 1
          }

          this.searchKeyword = ''
          this.searchCondition = 0
          console.log(res.data)
        })
        .catch(function (error) {
          console.log(error);
        });
    },
    region_kyeongnam() {
      this.areaCheck = 1
      this.regionCheck = 4
      this.regionCategoryCheck = 1
      this.$store.state.boardCheck = 4
      this.updateBoardCheck(4)
      this.currentPage = 0;
      const url = `/api/posts/region/${this.regionsAPI[4]}/${this.regionCategoryAPI[this.regionCategoryCheck]}`;
      this.$axios.get(url, { params: { page: this.currentPage } }, {
        headers: {
          Authorization: this.$store.state.token, // 헤더에 토큰 추가
        },
      })
        .then(res => {
          this.BoardList = res.data.data
          this.totalPage = res.data.count

          if (this.totalPage < 10) {
            this.totalPage = 1
          } else if (this.totalPage % 10 === 0) {
            this.totalPage = parseInt(this.totalPage / 10)
          } else {
            this.totalPage = parseInt(this.totalPage / 10) + 1
          }

          this.searchKeyword = ''
          this.searchCondition = 0
          console.log(res.data)
        })
        .catch(function (error) {
          console.log(error);
        });
    },
    regionCategory_talk() {
      this.regionCategoryCheck = 1
      this.$store.state.CategoryCheck = 1
      this.updateCategoryCheck(1)
      this.currentPage = 0;
      const url = `/api/posts/region/${this.regionsAPI[this.regionCheck]}/${this.regionCategoryAPI[1]}`;
      this.$axios.get(url, { params: { page: this.currentPage } }, {
        headers: {
          Authorization: this.$store.state.token, // 헤더에 토큰 추가
        },
      })
        .then(res => {
          this.BoardList = res.data.data
          this.totalPage = res.data.count

          if (this.totalPage < 10) {
            this.totalPage = 1
          } else if (this.totalPage % 10 === 0) {
            this.totalPage = parseInt(this.totalPage / 10)
          } else {
            this.totalPage = parseInt(this.totalPage / 10) + 1
          }

          this.searchKeyword = ''
          this.searchCondition = 0
          console.log(res.data)
        })
        .catch(function (error) {
          console.log(error);
        });
    },
    regionCategory_restaurant() {
      this.regionCategoryCheck = 2
      this.$store.state.CategoryCheck = 2
      this.updateCategoryCheck(2)
      this.currentPage = 0;
      const url = `/api/posts/region/${this.regionsAPI[this.regionCheck]}/${this.regionCategoryAPI[2]}`;
      this.$axios.get(url, { params: { page: this.currentPage } }, {
        headers: {
          Authorization: this.$store.state.token, // 헤더에 토큰 추가
        },
      })
        .then(res => {
          this.BoardList = res.data.data
          this.totalPage = res.data.count

          if (this.totalPage < 10) {
            this.totalPage = 1
          } else if (this.totalPage % 10 === 0) {
            this.totalPage = parseInt(this.totalPage / 10)
          } else {
            this.totalPage = parseInt(this.totalPage / 10) + 1
          }

          this.searchKeyword = ''
          this.searchCondition = 0
          console.log(res.data)
        })
        .catch(function (error) {
          console.log(error);
        });
    },
    regionCategory_play() {
      this.regionCategoryCheck = 3
      this.$store.state.CategoryCheck = 3
      this.updateCategoryCheck(3)
      this.currentPage = 0;
      const url = `/api/posts/region/${this.regionsAPI[this.regionCheck]}/${this.regionCategoryAPI[3]}`;

      this.$axios.get(url, { params: { page: this.currentPage } }, {
        headers: {
          Authorization: this.$store.state.token, // 헤더에 토큰 추가
        },
      })
        .then(res => {
          this.BoardList = res.data.data
          this.totalPage = res.data.count

          if (this.totalPage < 10) {
            this.totalPage = 1
          } else if (this.totalPage % 10 === 0) {
            this.totalPage = parseInt(this.totalPage / 10)
          } else {
            this.totalPage = parseInt(this.totalPage / 10) + 1
          }

          this.searchKeyword = ''
          this.searchCondition = 0
          console.log(res.data)
        })
        .catch(function (error) {
          console.log(error);
        });
    },
    regionCategory_meet() {
      this.regionCategoryCheck = 4
      this.$store.state.CategoryCheck = 4
      this.updateCategoryCheck(4)
      this.currentPage = 0;
      const url = `/api/posts/region/${this.regionsAPI[this.regionCheck]}/${this.regionCategoryAPI[4]}`;
      this.$axios.get(url, { params: { page: this.currentPage } }, {
        headers: {
          Authorization: this.$store.state.token, // 헤더에 토큰 추가
        },
      })
        .then(res => {
          this.BoardList = res.data.data
          this.totalPage = res.data.count

          if (this.totalPage < 10) {
            this.totalPage = 1
          } else if (this.totalPage % 10 === 0) {
            this.totalPage = parseInt(this.totalPage / 10)
          } else {
            this.totalPage = parseInt(this.totalPage / 10) + 1
          }

          this.searchKeyword = ''
          this.searchCondition = 0
          console.log(res.data)
        })
        .catch(function (error) {
          console.log(error);
        });
    },
    regionCategory_market() {
      this.regionCategoryCheck = 5
      this.$store.state.CategoryCheck = 5
      this.updateCategoryCheck(5)
      this.currentPage = 0;
      const url = `/api/posts/region/${this.regionsAPI[this.regionCheck]}/${this.regionCategoryAPI[5]}`;

      this.$axios.get(url, { params: { page: this.currentPage } }, {
        headers: {
          Authorization: this.$store.state.token, // 헤더에 토큰 추가
        },
      })
        .then(res => {
          this.BoardList = res.data.data
          this.totalPage = res.data.count

          if (this.totalPage < 10) {
            this.totalPage = 1
          } else if (this.totalPage % 10 === 0) {
            this.totalPage = parseInt(this.totalPage / 10)
          } else {
            this.totalPage = parseInt(this.totalPage / 10) + 1
          }

          this.searchKeyword = ''
          this.searchCondition = 0
          console.log(res.data)
        })
        .catch(function (error) {
          console.log(error);
        });
    },
    page() {
      const url = `/api/posts/region/${this.regionsAPI[this.regionCheck]}/${this.regionCategoryAPI[this.regionCategoryCheck]}`;
      this.$axios.get(url, { params: { page: this.currentPage } }, {
        headers: {
          Authorization: this.$store.state.token, // 헤더에 토큰 추가
        },
      })
        .then(res => {
          this.BoardList = res.data.data
          this.$store.commit('updateNowPage', this.currentPage);
          console.log(res.data)
        })
        .catch(function (error) {
          console.log(error);
        });
    },
    date() {
      this.now = new Date()
      this.month = this.now.getMonth() + 1
      this.month = this.month > 9 ? this.month : `0${this.month}`;
      this.day = this.now.getDate()

      this.today = this.month + '-' + this.day
    },
    getAddr,
    loginToken() {
      const token = this.getToken; // Vuex 스토어에서 토큰 값을 가져옴

      const base64Url = token.split('.')[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      const decodedPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
      }).join(''));
      const claims = JSON.parse(decodedPayload);
      this.userNickName = claims.nickname;
    }
  },
}
</script>
